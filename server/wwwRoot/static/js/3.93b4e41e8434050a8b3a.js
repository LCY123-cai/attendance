webpackJsonp([3],{"8Kdp":function(e,t){},I46q:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("aA9S"),a=s.n(i),l=s("lC5x"),o=s.n(l),n=s("J0Oq"),r=s.n(n),c={data:function(){return{excelFile:[],lName:"",cur:1,pageSize:10,total:0,dialogVisible:!1,dialogVisible2:!1,lessons:[],lessonDetail:{id:"",name:"",teach_time:"",area:"",lesson_code:""}}},props:["CommonObj"],methods:{getLesson:function(){var e=this;return r()(o.a.mark(function t(){var s;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/api/lesson/list",{params:{page:e.cur,pageSize:e.pageSize}});case 2:s=t.sent,e.lessons=s.list,e.total=s.total;case 5:case"end":return t.stop()}},t,e)}))()},handleEdit:function(e){this.dialogVisible2=!0,this.lessonDetail=a()({},e)},handleDelete:function(e){var t=this;this.$confirm("确认要删除这门课程？").then(function(s){t.delete(e.id)}).catch(function(e){})},delete:function(e){var t=this;this.$http.post("api/lesson/delete",{id:e}).then(function(e){t.$message({type:"success",message:"删除成功"}),t.getLesson()})},handleSizeChange:function(e){this.pageSize=e,this.getLesson()},clearUpload:function(){this.$refs.uploadDiv.clearFiles(),this.lName=""},beforeClose:function(e){this.clearUpload(),e()},handleChange:function(e){if(e.response&&1==e.response.code)return this.getLesson(),this.clearUpload(),this.dialogVisible=!1,void this.$message.success("上传成功");if(e.response&&0==e.response.code)return this.clearUpload(),this.dialogVisible=!1,void this.$message.error("上传失败,"+e.response.msg);if("fail"==e.status)return this.lName="",void this.$message.error("上传失败,服务器后台错误");var t=e.name.endsWith(".xls")||e.name.endsWith(".apsx"),s=e.size/1024/1024<1;t?s||(this.$message.error("上传的文件大小不能超过1M"),this.$refs.uploadDiv.clearFiles()):(this.$message.error("只能上传正方系统导出的xls或者aspx文件!"),this.$refs.uploadDiv.clearFiles()),this.lName=this.lName?this.lName:e.name.replace(".xls","")},upload:function(){this.lName="",this.$refs.uploadDiv.submit()},submitForm:function(){var e=this;this.$http.post("/api/lesson/update",this.lessonDetail).then(function(t){e.$message({type:"success",message:"更新成功"}),e.getLesson(),e.dialogVisible2=!1})},toDetail:function(e){this.CommonObj.lessonId=e.id,this.CommonObj.lessonName=e.name,this.CommonObj.changePage(1)}},mounted:function(){var e=this;this.$nextTick(function(){e.getLesson()})},activated:function(){var e=this;this.$nextTick(function(){e.getLesson()})}},u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"lesson"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("导入新课程")]),e._v(" "),s("hr"),e._v(" "),s("div",{staticStyle:{width:"100%",overflow:"hidden"}},[s("el-table",{attrs:{data:e.lessons}},[s("el-table-column",{attrs:{prop:"id",label:"ID",width:"60"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"名字",width:"200"}}),e._v(" "),s("el-table-column",{attrs:{prop:"teach_time",label:"上课时间",width:"250"}}),e._v(" "),s("el-table-column",{attrs:{prop:"area",label:"上课地点",width:"150"}}),e._v(" "),s("el-table-column",{attrs:{prop:"lesson_code",label:"选课课号"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(s){e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(s){e.handleDelete(t.row)}}},[e._v("删除")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"考勤记录",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){e.toDetail(t.row)}}},[e._v("详情")])]}}])})],1)],1),e._v(" "),s("el-pagination",{attrs:{"current-page":e.cur,"page-sizes":[10,50,100],background:"","page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.getLesson,"size-change":e.handleSizeChange,"update:currentPage":function(t){e.cur=t}}}),e._v(" "),s("el-dialog",{attrs:{title:"导入新课程",visible:e.dialogVisible,width:"403px","before-close":e.beforeClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-input",{attrs:{placeholder:'课程名称（如"电机学（12电气56班）"）'},model:{value:e.lName,callback:function(t){e.lName=t},expression:"lName"}}),e._v(" "),s("el-upload",{ref:"uploadDiv",attrs:{limit:1,"auto-upload":!1,drag:"","on-change":e.handleChange,"on-success":e.clearUpload,data:{lessonName:e.lName},action:"api/lesson/import"}},[s("i",{staticClass:"el-icon-upload"}),e._v(" "),s("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),s("em",[e._v("点击上传")])]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传xls或aspx文件，且不超过1Mb")])]),e._v(" "),s("el-button",{staticStyle:{display:"block",margin:"10px auto"},attrs:{size:"mini",type:"primary"},on:{click:e.upload}},[e._v("上传并导入")])],1),e._v(" "),s("el-dialog",{attrs:{title:"编辑课程",visible:e.dialogVisible2},on:{"update:visible":function(t){e.dialogVisible2=t}}},[s("el-form",{ref:"lessonDetail",attrs:{model:e.lessonDetail,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"id"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.lessonDetail.id,callback:function(t){e.$set(e.lessonDetail,"id",t)},expression:"lessonDetail.id"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"选课编号",prop:"lesson_code"}},[s("el-input",{attrs:{disabled:!0},model:{value:e.lessonDetail.lesson_code,callback:function(t){e.$set(e.lessonDetail,"lesson_code",t)},expression:"lessonDetail.lesson_code"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"名字",prop:"name"}},[s("el-input",{attrs:{maxlength:64},model:{value:e.lessonDetail.name,callback:function(t){e.$set(e.lessonDetail,"name",t)},expression:"lessonDetail.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"上课时间",prop:"teach_time"}},[s("el-input",{attrs:{maxlength:128},model:{value:e.lessonDetail.teach_time,callback:function(t){e.$set(e.lessonDetail,"teach_time",t)},expression:"lessonDetail.teach_time"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"上课地点",prop:"area"}},[s("el-input",{attrs:{maxlength:32},model:{value:e.lessonDetail.area,callback:function(t){e.$set(e.lessonDetail,"area",t)},expression:"lessonDetail.area"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm()}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var m=s("Z0/y")(c,u,!1,function(e){s("Juhb")},null,null).exports,d=s("0xDb"),p=s.n(d),h={data:function(){return{list:[],dialogVisible:!1,dialogVisible2:!1,title:"",students:[],series:void 0,scoreForm:{normal:"",noAttend:"",late:"",early:"",leave:""},rules:{normal:[{validator:this.validateNum,trigger:"blur"}],noAttend:[{validator:this.validateNum,trigger:"blur"}],late:[{validator:this.validateNum,trigger:"blur"}],early:[{validator:this.validateNum,trigger:"blur"}],leave:[{validator:this.validateNum,trigger:"blur"}]}}},components:{attendTable:s("WAeT").a},props:["CommonObj"],methods:{validateNum:function(e,t,s){isNaN(Number(t))?s(new Error("请输入正确的数字")):t.split(".")[1]&&t.split(".")[1].length>2?s(new Error("小数最多保留两位")):s()},getList:function(){var e=this;return r()(o.a.mark(function t(){var s,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/api/record/list",{params:{id:e.CommonObj.lessonId}});case 2:return s=t.sent,e.list=s,t.next=6,e.$http.get("/api/lesson/scoreConf",{params:{id:e.CommonObj.lessonId}});case 6:i=t.sent.split(","),e.scoreForm.normal=i[0],e.scoreForm.noAttend=i[1],e.scoreForm.late=i[2],e.scoreForm.early=i[3],e.scoreForm.leave=i[4];case 12:case"end":return t.stop()}},t,e)}))()},dateFormat:function(e,t,s){return p.a.DateTransfer(new Date(s),"yyyy-MM-dd hh:mm:ss")},detail:function(e){var t=this;this.title=e.order,this.dialogVisible=!0,this.series=e.series,this.$http.get("api/record/detail",{params:{id:this.CommonObj.lessonId,series:e.series}}).then(function(e){t.students=e})},handleSubmit:function(){var e=this;this.$http.post("api/record/update",{lid:this.CommonObj.lessonId,list:this.students,series:this.series}).then(function(t){e.dialogVisible=!1,e.$message({type:"success",message:"更新成功"})})},handleSubmit2:function(){var e=this;this.$refs.scoreForm.validate(function(t){if(t){var s=[];for(var i in e.scoreForm)s.push(e.scoreForm[i]);e.$http.post("api/lesson/scoreConf",{id:e.CommonObj.lessonId,attend_score:s.map(function(e){return Number(e)}).join(",")}).then(function(t){e.dialogVisible2=!1,e.$message({type:"success",message:"更新成功"}),e.getList()})}})},exportExcel:function(){location.href="api/export/attendance?id="+this.CommonObj.lessonId}},mounted:function(){var e=this;this.$nextTick(function(){e.getList()})},activated:function(){var e=this;this.$nextTick(function(){e.getList()})}},v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.CommonObj.changePage(0)}}},[e._v("返回")]),e._v(" "),s("el-button",{staticClass:"right-lbtn",attrs:{size:"mini",type:"success"},on:{click:e.exportExcel}},[e._v("导出考勤表")]),e._v(" "),s("el-button",{staticClass:"right-lbtn",attrs:{size:"mini",type:"warning"},on:{click:function(t){e.dialogVisible2=!0}}},[e._v("配置考勤分数")]),e._v(" "),s("hr"),e._v(" "),s("h1",[e._v(e._s(e.CommonObj.lessonName))]),e._v(" "),s("el-table",{attrs:{data:e.list}},[s("el-table-column",{attrs:{prop:"order",label:"考勤序列"}}),e._v(" "),s("el-table-column",{attrs:{prop:"date",label:"考勤时间",formatter:e.dateFormat}}),e._v(" "),s("el-table-column",{attrs:{prop:"count",label:"抽查人数"}}),e._v(" "),s("el-table-column",{attrs:{label:"考勤情况",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){e.detail(t.row)}}},[e._v("详情")])]}}])})],1),e._v(" "),s("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("attendTable",{attrs:{list:e.students}}),e._v(" "),s("div",{staticClass:"attend-btns"},[s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSubmit}},[e._v("确定修改")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"配置考勤分数",visible:e.dialogVisible2},on:{"update:visible":function(t){e.dialogVisible2=t}}},[s("el-form",{ref:"scoreForm",attrs:{inline:!0,model:e.scoreForm,rules:e.rules}},[s("el-form-item",{attrs:{prop:"normal",label:"正常:"}},[s("el-input",{staticClass:"score-input",model:{value:e.scoreForm.normal,callback:function(t){e.$set(e.scoreForm,"normal",t)},expression:"scoreForm.normal"}}),e._v(" 分\n          ")],1),e._v(" "),s("el-form-item",{attrs:{prop:"noAttend",label:"缺勤:"}},[s("el-input",{staticClass:"score-input",model:{value:e.scoreForm.noAttend,callback:function(t){e.$set(e.scoreForm,"noAttend",t)},expression:"scoreForm.noAttend"}}),e._v(" 分\n          ")],1),e._v(" "),s("el-form-item",{attrs:{prop:"late",label:"迟到:"}},[s("el-input",{staticClass:"score-input",model:{value:e.scoreForm.late,callback:function(t){e.$set(e.scoreForm,"late",t)},expression:"scoreForm.late"}}),e._v(" 分\n          ")],1),e._v(" "),s("el-form-item",{attrs:{prop:"early",label:"早退:"}},[s("el-input",{staticClass:"score-input",model:{value:e.scoreForm.early,callback:function(t){e.$set(e.scoreForm,"early",t)},expression:"scoreForm.early"}}),e._v(" 分\n          ")],1),e._v(" "),s("el-form-item",{attrs:{prop:"leave",label:"请假:"}},[s("el-input",{staticClass:"score-input",model:{value:e.scoreForm.leave,callback:function(t){e.$set(e.scoreForm,"leave",t)},expression:"scoreForm.leave"}}),e._v(" 分\n          ")],1),e._v(" "),s("div",{staticClass:"attend-btns"},[s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){e.dialogVisible2=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSubmit2}},[e._v("确定修改")])],1)],1)],1)],1)},staticRenderFns:[]};var b={data:function(){return{showStatus:0,commonSpace:{lessonId:"",lessonName:"",changePage:this.changePage.bind(this)}}},methods:{changePage:function(e){this.showStatus=e}},components:{lessonComp:m,listComp:s("Z0/y")(h,v,!1,function(e){s("8Kdp")},null,null).exports}},f={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[0==this.showStatus?t("lessonComp",{attrs:{CommonObj:this.commonSpace}}):this._e(),this._v(" "),1==this.showStatus?t("listComp",{attrs:{CommonObj:this.commonSpace}}):this._e()],1)},staticRenderFns:[]};var g=s("Z0/y")(b,f,!1,function(e){s("owXT")},null,null);t.default=g.exports},Juhb:function(e,t){},owXT:function(e,t){}});
//# sourceMappingURL=3.93b4e41e8434050a8b3a.js.map