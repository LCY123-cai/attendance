webpackJsonp([1],{GDFz:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("aA9S"),n=s.n(i),a=s("lC5x"),l=s.n(a),o=s("J0Oq"),r=s.n(o),u=s("0xDb"),c=s.n(u),d={data:function(){return{cur:1,pageSize:10,total:0,classes:[],dialogVisible:!1,classDetail:{id:"",name:""}}},props:["CommonObj"],methods:{getClass:function(){var t=this;return r()(l.a.mark(function e(){var s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("/api/student/class",{params:{page:t.cur,pageSize:t.pageSize}});case 2:s=e.sent,t.total=s.total,t.classes=s.list;case 5:case"end":return e.stop()}},e,t)}))()},detail:function(t){this.CommonObj.classId=t.id,this.CommonObj.className=t.name,this.CommonObj.changePage(1)},handleSizeChange:function(t){this.pageSize=t,this.getClass()},dateFormat:function(t,e,s){return c.a.DateTransfer(new Date(s),"yyyy-MM-dd hh:mm:ss")},handleEdit:function(t){this.dialogVisible=!0,this.classDetail=n()({},t)},handleDelete:function(t){var e=this;this.$confirm("确认要删除这个班级？").then(function(s){e.delete(t.id)}).catch(function(t){})},delete:function(t){var e=this;this.$http.post("api/student/cDelete",{id:t}).then(function(t){e.$message({type:"success",message:"删除成功"}),e.getClass()})},submitForm:function(){var t=this;this.$http.post("/api/student/cUpdate",this.classDetail).then(function(e){t.$message({type:"success",message:"更新成功"}),t.getClass(),t.dialogVisible=!1})}},mounted:function(){var t=this;this.$nextTick(function(){t.getClass()})},activated:function(){var t=this;this.$nextTick(function(){t.getClass()})}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"myClass"},[s("h1",[t._v("选择班级")]),t._v(" "),s("hr"),t._v(" "),s("div",{staticStyle:{width:"100%",overflow:"hidden"}},[s("el-table",{attrs:{data:t.classes}},[s("el-table-column",{attrs:{prop:"id",label:"ID",width:"200"}}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"名字"}}),t._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"添加时间",formatter:t.dateFormat}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(s){t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(s){t.handleDelete(e.row)}}},[t._v("删除")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"成员",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){t.detail(e.row)}}},[t._v("详情")])]}}])})],1)],1),t._v(" "),s("el-pagination",{attrs:{"current-page":t.cur,"page-sizes":[10,50,100],background:"","page-size":t.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"current-change":t.getClass,"size-change":t.handleSizeChange,"update:currentPage":function(e){t.cur=e}}}),t._v(" "),s("el-dialog",{attrs:{title:"编辑课程",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{ref:"classDetail",attrs:{model:t.classDetail,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"id"}},[s("el-input",{attrs:{disabled:!0},model:{value:t.classDetail.id,callback:function(e){t.$set(t.classDetail,"id",e)},expression:"classDetail.id"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"名字",prop:"name"}},[s("el-input",{attrs:{maxlength:64},model:{value:t.classDetail.name,callback:function(e){t.$set(t.classDetail,"name",e)},expression:"classDetail.name"}})],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm()}}},[t._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var h=s("Z0/y")(d,m,!1,function(t){s("tOcV")},null,null).exports,p={data:function(){return{students:[],rules:{name:[{required:!0,message:"请输入学生姓名",trigger:"blur"},{min:2,max:16,message:"长度在 2 到 16 个字符",trigger:"blur"}],student_code:[{required:!0,message:"请输入学生学号",trigger:"blur"},{validator:this.checkCode,trigger:"blur"}]},studentForm:{id:"",name:"",student_code:"",lesson_ids:"",class_id:""},dynamicTags:[],inputVisible:!1,inputValue:"",options:[],dialogVisible:!1,isAdd:!0,studentName:"",studentId:"",dialogVisible2:!1,title:"",title2:"",list:[]}},components:{attendTable:s("WAeT").a},props:["CommonObj"],methods:{getStudents:function(){var t=this;return r()(l.a.mark(function e(){var s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.get("/api/student/list",{params:{id:t.CommonObj.classId}});case 2:s=e.sent,t.students=s.list;case 4:case"end":return e.stop()}},e,t)}))()},getLesson:function(){var t=this;return r()(l.a.mark(function e(){var s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$http.post("/api/lesson/list");case 2:s=e.sent,t.options=s;case 4:case"end":return e.stop()}},e,t)}))()},handleSubmit:function(){var t=this;this.$http.post("api/record/sUpdate",{sid:this.studentId,list:this.list}).then(function(e){t.dialogVisible2=!1,t.$message({type:"success",message:"更新成功"})})},showAdd:function(){this.isAdd=!0,this.dialogVisible=!0,this.studentForm.id="",this.studentForm.name="",this.studentForm.student_code="",this.title2="添加学生"},handleDelete:function(t){var e=this;this.$confirm("确认要删除这个学生吗？").then(function(s){e.delete(t.id)}).catch(function(t){})},delete:function(t){var e=this;this.$http.post("api/student/delete",{id:t}).then(function(t){e.$message({type:"success",message:"删除成功"}),e.updatePage()})},handleEdit:function(t){var e=this;this.isAdd=!1,this.dialogVisible=!0,this.studentForm.id=t.id,this.studentForm.name=t.name,this.studentForm.student_code=t.student_code,this.title2="修改学生资料",this.options.forEach(function(s){t.lesson_ids.split(",").forEach(function(t){t==s.id&&e.dynamicTags.push(s)})})},detail:function(t){var e=this;this.studentId=t.id,this.studentName=t.name,this.dialogVisible2=!0,this.$http.get("api/record/sDetail",{params:{id:t.id}}).then(function(t){e.list=t})},submitForm:function(){var t=this;this.$refs.studentForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.sendStu()})},sendStu:function(){var t=this;this.isAdd?this.$http.post("api/student/add",{student_code:this.studentForm.student_code,name:this.studentForm.name,class_id:this.CommonObj.classId,lesson_ids:this.dynamicTags.map(function(t){return t.id}).join(",")}).then(function(e){t.$message({type:"success",message:"添加成功"}),t.updatePage(),t.dialogVisible=!1}):this.$http.post("api/student/update",{id:this.studentForm.id,student_code:this.studentForm.student_code,name:this.studentForm.name,lesson_ids:this.dynamicTags.map(function(t){return t.id}).join(",")}).then(function(e){t.$message({type:"success",message:"更新成功"}),t.updatePage(),t.dialogVisible=!1})},updatePage:function(){this.getLesson(),this.getStudents(),this.clearForm()},checkCode:function(t,e,s){/^\d{12}$/.test(e)?s():s(new Error("学号应该为12位数字"))},clearForm:function(){this.$refs.studentForm&&this.$refs.studentForm.resetFields(),this.inputVisible=!1,this.inputValue="",this.dynamicTags=[]},beforeClose:function(t){this.clearForm(),t()},handleClose:function(t){this.dynamicTags.splice(this.dynamicTags.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.reference.$el.click()})},handleInputConfirm:function(){var t=this.inputValue;this.dynamicTags.filter(function(e){return e.id==t.id}).length>0?this.$message({type:"error",message:"不能选择重复的课程"}):t&&this.dynamicTags.push(t),this.inputVisible=!1,this.inputValue=""}},mounted:function(){var t=this;this.$nextTick(function(){t.getStudents(),t.getLesson()})},activated:function(){var t=this;this.$nextTick(function(){t.getStudents(),t.getLesson()})},watch:{"CommonObj.className":{handler:function(){this.getStudents()},deep:!0}}},f={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"student-list"},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(e){t.CommonObj.changePage(0)}}},[t._v("返回")]),t._v(" "),s("el-button",{staticStyle:{float:"right"},attrs:{size:"mini",type:"primary"},on:{click:t.showAdd}},[t._v("添加学生")]),t._v(" "),s("hr"),t._v(" "),s("h1",[t._v(t._s(t.CommonObj.className))]),t._v(" "),s("div",{staticStyle:{width:"100%",overflow:"hidden"}},[s("el-table",{attrs:{data:t.students}},[s("el-table-column",{attrs:{prop:"id",label:"ID",width:"100"}}),t._v(" "),s("el-table-column",{attrs:{prop:"student_code",label:"学号",width:"180"}}),t._v(" "),s("el-table-column",{attrs:{prop:"name",label:"姓名",width:"150"}}),t._v(" "),s("el-table-column",{attrs:{prop:"lnames",label:"参加课程"}}),t._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(s){t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(s){t.handleDelete(e.row)}}},[t._v("删除")])]}}])}),t._v(" "),s("el-table-column",{attrs:{label:"考勤情况",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(s){t.detail(e.row)}}},[t._v("详情")])]}}])})],1)],1),t._v(" "),s("el-dialog",{attrs:{title:t.title2,visible:t.dialogVisible,"before-close":t.beforeClose},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("el-form",{ref:"studentForm",attrs:{model:t.studentForm,rules:t.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"姓名：",prop:"name"}},[s("el-input",{model:{value:t.studentForm.name,callback:function(e){t.$set(t.studentForm,"name",e)},expression:"studentForm.name"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"学号：",prop:"student_code"}},[s("el-input",{model:{value:t.studentForm.student_code,callback:function(e){t.$set(t.studentForm,"student_code",e)},expression:"studentForm.student_code"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"课程：",prop:"less"}},[t._l(t.dynamicTags,function(e){return s("el-tag",{key:e.id,attrs:{closable:"","disable-transitions":!1},on:{close:function(s){t.handleClose(e)}}},[t._v(t._s(e.name))])}),t._v(" "),s("el-select",{directives:[{name:"show",rawName:"v-show",value:t.inputVisible,expression:"inputVisible"}],ref:"saveTagInput",staticClass:"len-mini",attrs:{placeholder:"请选择"},on:{change:t.handleInputConfirm},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}},t._l(t.options,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),t._v(" "),s("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.inputVisible,expression:"!inputVisible"}],staticClass:"button-new-tag",on:{click:t.showInput}},[t._v("+ 参与课程")])],2),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm()}}},[t._v("确定")])],1)],1)],1),t._v(" "),s("el-dialog",{attrs:{title:t.studentName,visible:t.dialogVisible2},on:{"update:visible":function(e){t.dialogVisible2=e}}},[s("attendTable",{attrs:{list:t.list,lesson:!0}}),t._v(" "),s("div",{staticClass:"attend-btns"},[s("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(e){t.dialogVisible2=!1}}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleSubmit}},[t._v("确定修改")])],1)],1)],1)},staticRenderFns:[]};var b={data:function(){return{showStatus:0,commonSpace:{classId:"",className:"",changePage:this.changePage.bind(this)}}},methods:{changePage:function(t){this.showStatus=t}},components:{classComp:h,listComp:s("Z0/y")(p,f,!1,function(t){s("M1ph")},null,null).exports}},g={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[0==this.showStatus?e("classComp",{attrs:{CommonObj:this.commonSpace}}):this._e(),this._v(" "),1==this.showStatus?e("listComp",{attrs:{CommonObj:this.commonSpace}}):this._e()],1)},staticRenderFns:[]};var v=s("Z0/y")(b,g,!1,function(t){s("TwmE")},null,null);e.default=v.exports},M1ph:function(t,e){},TwmE:function(t,e){},tOcV:function(t,e){}});
//# sourceMappingURL=1.b9a22c2feee9a9148d54.js.map